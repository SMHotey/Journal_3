<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Список заказов</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <style>
        .custom-cell {
            font-size: 20px;
            color: green;
            font-weight: bold;
            text-decoration: underline;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h1 class="mb-4">Список заказов</h1>
    
    <table class="table table-bordered text-center">
        <thead>
            <tr>
                <th>#</th>
                <th>1 НК</th>
                <th>1 СК</th>
                <th>2 НК</th>
                <th>2 СК</th>
                <th>Люк НК</th>
                <th>Люк СК</th>
                <th>Ворота</th>
                <th>Фрамуга</th>
                <th>Стекло</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td class="custom-cell">{{ order.number }}</td>
                <td>{{ order.doors_nk }}</td>
                <td>{{ order.doors_sk }}</td>
                <td>{{ order.doors_2nk }}</td>
                <td>{{ order.doors_2sk }}</td>
                <td>{{ order.hatches_nk }}</td>
                <td>{{ order.hatches_sk }}</td>
                <td>{{ order.gates }}</td>
                <td>{{ order.vent }}</td>
                <td>
                    {% if order.glass_order %}
                        <button class="btn btn-info btn-glass" 
                                onclick="showGlassOrder('{{ order.number }}')">
                            Стекло
                        </button>
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'delete_order' order.number %}">Удалить</a>
                </td>
            </tr>
            <script id="glass-order-{{ order.number }}" type="application/json">
                {{ order.glass_order|json_script }}
            </script>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    function showGlassOrder(orderId) {
        const glassOrderElement = document.getElementById(`glass-order-${orderId}`);
        const jsonString = glassOrderElement.innerHTML;
        const jsonData = jsonString.replace(/<script.*?>|<\/script>/g, '').trim();
        const glassOrderData = JSON.parse(jsonData);

        let tableHtml = '<table class="table table-bordered text-center"><tr><th>Размер стекла</th><th>Количество</th></tr>';
        for (const [size, quantity] of Object.entries(glassOrderData)) {
            tableHtml += `<tr><td>${size}</td><td>${quantity}</td></tr>`;
        }
        tableHtml += '</table>';

        createModal(tableHtml);
    }

    function createModal(tableHtml) {
        const modal = document.createElement('div');
        modal.style.position = 'fixed';
        modal.style.top = '50%';
        modal.style.left = '50%';
        modal.style.transform = 'translate(-50%, -50%)';
        modal.style.backgroundColor = 'white';
        modal.style.border = '1px solid #ccc';
        modal.style.padding = '20px';
        modal.style.zIndex = '1000';

        const overlay = document.createElement('div');
        overlay.style.position = 'fixed';
        overlay.style.top = '0';
        overlay.style.left = '0';
        overlay.style.width = '100%';
        overlay.style.height = '100%';
        overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
        overlay.style.zIndex = '999';
        document.body.appendChild(overlay);

        const closeButton = document.createElement('button');
        closeButton.textContent = 'Закрыть';
        closeButton.onclick = () => {
            document.body.removeChild(modal);
            document.body.removeChild(overlay);
        };

        modal.innerHTML = tableHtml;
        modal.appendChild(closeButton);
        document.body.appendChild(modal);
    }
</script>
</body>
</html>